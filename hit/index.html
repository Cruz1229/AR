<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>AR sin Marcador</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  
  <script>
    AFRAME.registerComponent('tap-to-place', {
      init: function() {
        const scene = this.el.sceneEl;
        const model = document.getElementById('modelo3d');
        let isPlaced = false;
        
        // Mostrar el modelo inmediatamente, pero invisible
        model.setAttribute('visible', 'false');
        
        // Función para colocar el modelo donde el usuario toca
        function placeModel(event) {
          // Solo permite mover si no está fijado
          if (!isPlaced) {
            // Obtener posición donde se tocó
            const touchPosition = event.detail.intersection.point;
            model.setAttribute('position', touchPosition);
            model.setAttribute('visible', 'true');
            
            // Preguntar al usuario si quiere fijar el modelo
            if (confirm('¿Deseas fijar el modelo en esta ubicación?')) {
              isPlaced = true;
              // Opcional: Mostrar algún feedback visual de que está fijo
              console.log('Modelo fijado en posición');
            }
          }
        }
        
        // Escuchar eventos de clic/tap en la escena
        scene.addEventListener('click', function(e) {
          placeModel(e);
        });
      }
    });
  </script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    renderer="logarithmicDepthBuffer: true;"
    vr-mode-ui="enabled: false"
    tap-to-place>
    
    <!-- Superficie donde se detectará el piso -->
    <a-plane
      id="suelo"
      rotation="-90 0 0"
      width="100"
      height="100"
      color="rgba(0,0,0,0)"
      material="opacity: 0.0"
      class="collidable"></a-plane>
    
    <!-- Modelo 3D que aparecerá automáticamente -->
    <a-entity
      id="modelo3d"
      gltf-model="url(scene.gltf)"
      scale="0.5 0.5 0.5"
      rotation="-90 0 0"
      position="0 0 -1"
      visible="true"></a-entity>
    
    <!-- Cámara para AR -->
    <a-entity camera look-controls wasd-controls></a-entity>
  </a-scene>
</body>
</html>