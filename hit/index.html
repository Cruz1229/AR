<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>AR con WebXR Hit Test</title>
  <!-- A-Frame 1.7+ para soporte WebXR -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <!-- Componente ar-hit-test de A-Frame -->
  <script src="https://unpkg.com/aframe-ar-hit-test-component@4.0.1/dist/aframe-ar-hit-test-component.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    webxr="optionalFeatures: hit-test"
    ar-hit-test="target: #model; reticle: #reticle"
  >
    <!-- Retículo que muestra dónde hay superficie -->
    <a-entity
      id="reticle"
      geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.06"
      rotation="-90 0 0"
      visible="false">
    </a-entity>

    <!-- Modelo 3D oculto hasta colocación -->
    <a-entity
      id="model"
      gltf-model="url(scene.gltf)"
      scale="0.5 0.5 0.5"
      visible="false">
    </a-entity>

    <!-- Cámara AR -->
    <a-entity camera look-controls></a-entity>
  </a-scene>

  <script>
    const sceneEl = document.querySelector('a-scene');

    sceneEl.addEventListener('enter-vr', () => {
      // Solo interesa cuando realmente entramos en modo AR
      if (!sceneEl.is('ar-mode')) return;

      // Cuando el hit-test haya detectado una superficie
      sceneEl.addEventListener('ar-hit-test-achieved', () => {
        const reticle = document.querySelector('#reticle');
        reticle.setAttribute('visible', 'true');
        console.log('Superficie detectada: toca la pantalla para colocar el modelo.');
      }, { once: true });

      // Al tocar la pantalla, colocamos y anclamos el modelo
      sceneEl.addEventListener('ar-hit-test-select', (event) => {
        const model = document.querySelector('#model');
        // Posiciona el modelo en la pose devuelta por hit-test
        const pose = event.detail.position;
        const rotation = event.detail.rotation;
        model.setAttribute('position', pose);
        model.setAttribute('rotation', rotation);
        model.setAttribute('visible', 'true');
        console.log('Modelo colocado y anclado en el mundo real.');
      }, { once: true });
    });
  </script>
</body>
</html>
